<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <data>

        <!-- Form -->
        <record id="budget_realization_view_form" model="ir.ui.view">
            <field name="name">budget.realization.view.form</field>
            <field name="model">budget.realization</field>
            <field name="arch" type="xml">
                <form string="">
                    <header>
                        <field name="state" widget="statusbar" statusbar_visible='draft,submit,done'/>
                        <button string="Submit" name="button_submit" type="object" class="oe_highlight" invisible="state != 'draft'"/>
                        <button string="Done" name="button_done" type="object" class="oe_highlight" invisible="state != 'submit'"/> 
                        <button string="Set to Draft" name="button_draft" type="object" invisible="state not in ['submit', 'cancel']"/> 
                        <button string="Cancel" name="button_cancel" type="object" invisible="state in ['draft','cancel']"/>
                    </header>
                    <sheet>
                        <field name="currency_id" invisible='1'/>
                        <div class='oe_title'>
                            <h1>
                                <field name="name" readonly='1'/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="description" required='1' readonly="state != 'draft'"/>
                                <field name="planning_id" options="{'no_create': True}" required='1' readonly="state != 'draft'"/>
                            </group>
                            <group>
                                <field name="date" required='1' readonly="state != 'draft'"/>
                            </group>
                        </group>
                        <field name="line_ids" readonly="state != 'draft'"/>
                        <group class="oe_subtotal_footer oe_right">
                            <field name="total" class="oe_subtotal_footer" />
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids" widget="mail_followers"/>
                        <field name="activity_ids" widget="mail_activity"/>
                        <field name="message_ids" widget="mail_thread"/>
                    </div>
                </form>
            </field>
        </record>

        <record id="budget_realization_line_view_form" model="ir.ui.view">
            <field name="name">budget.realization.line.view.form</field>
            <field name="model">budget.realization.line</field>
            <field name="arch" type="xml">
                <form string="">
                    <sheet>
                        <field name="planning_id" invisible='1'/>
                        <div class='oe_title'>
                            <h1>
                                <field name="name" />
                            </h1>
                        </div>
                        <group>
                            <field name="realization_id" />
                        </group>
                        <group col='4'>
                            <field name="budget_line_id" domain="[('budget_id','=',planning_id), ('is_active','=', True)]" required="1"/>
                            <field name="amount" />
                            <field name="currency_id" invisible='1'/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>

        <!-- Kanban -->
        <record id="budget_realization_view_kanban" model="ir.ui.view">
            <field name="name">budget.realization.view.kanban</field>
            <field name="model">budget.realization</field>
            <field name="arch" type="xml">
                <kanban>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_global_click">
                                <div>
                                    <span class="o_kanban_record_title">
                                        <strong><field name="description" /></strong>
                                    </span>
                                </div>
                                <hr class="mt4 mb8"/>
                                <div class="o_kanban_record_subtitle">
                                    <field name="name" />
                                    <br/>
                                    Date:
                                    <field name="date"/>
                                    <br/>
                                    Budget: 
                                    <field name="planning_id"/>
                                    <br/>
                                    Status: 
                                    <field name="state" widget="badge" decoration-info="state == 'submit'" decoration-success="state == 'done'"/>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <record id="budget_realization_line_view_kanban" model="ir.ui.view">
            <field name="name">budget.realization.line.view.kanban</field>
            <field name="model">budget.realization.line</field>
            <field name="arch" type="xml">
                <kanban>
                    <field name="currency_id" invisible="1"/>
                    <templates>
                        <t t-name="kanban-box">
                            <div t-attf-class="oe_kanban_global_click">
                                <div>
                                    <span class="o_kanban_record_title">
                                        <strong><field name="name" /></strong>
                                    </span>
                                </div>
                                <hr class="mt4 mb8"/>
                                <div class="o_kanban_record_subtitle">
                                    <field name="realization_id" />
                                    <br/>
                                    Budget:
                                    <field name="budget_line_id"/>
                                    <br/>
                                    Amount: 
                                    <field name="amount"/>
                                </div>
                            </div>
                        </t>
                    </templates>
                </kanban>
            </field>
        </record>

        <!-- Tree -->
        <record id="budget_realization_view_tree" model="ir.ui.view">
            <field name="name">budget.realization.view.tree</field>
            <field name="model">budget.realization</field>
            <field name="arch" type="xml">
                <tree string="">
                    <field name="name" />
                    <field name="planning_id" />
                    <field name="description" />
                    <field name="date" />
                    <field name="total" sum="Total"/>
                    <field name="state" widget="badge" decoration-info="state == 'submit'" decoration-success="state == 'done'" decoration-danger="state == 'cancel'"/>
                    <field name="currency_id" column_invisible='1'/>
                </tree>
            </field>
        </record>

        <record id="budget_realization_line_view_tree" model="ir.ui.view">
            <field name="name">budget.realization.line.view.tree</field>
            <field name="model">budget.realization.line</field>
            <field name="arch" type="xml">
                <tree editable='bottom'>
                    <field name="name" required='1'/>
                    <field name="budget_line_id" required='1' domain="[('budget_id','=',planning_id), ('is_active','=', True)]" options="{'no_create': True, 'no_open': True}"/>
                    <field name="amount" required='1' sum="Total"/>
                    <field name="currency_id" column_invisible='1'/>
                    <field name="planning_id" column_invisible='1'/>
                </tree>
            </field>
        </record>

        <!-- Search -->
        <record id="budget_realization_view_search" model="ir.ui.view">
            <field name="name">budget.realization.view.search</field>
            <field name="model">budget.realization</field>
            <field name="arch" type="xml">
                <search string="">
                    <field name="description" />
                    <field name="planning_id" />
                    <group expand="0" string="Group By">
                        <filter string="Budget" name="budget" context="{'group_by':'planning_id'}"/>
                    </group>
                </search>
            </field>
        </record>
    
        <!-- Action -->
        <record id="budget_realization_action" model="ir.actions.act_window">
            <field name="name">Budget Realization</field>
            <field name="res_model">budget.realization</field>
            <field name="view_mode">tree,kanban,form</field>
        </record>

        <!-- Action Server -->
        <record id="mass_submit_realization_action_server" model="ir.actions.server">
            <field name="name">Submit</field>
            <field name="model_id" ref="model_budget_realization"/>
            <field name="binding_model_id" ref="model_budget_realization"/>
            <field name="state">code</field>
            <field name="code">
                for r in records.filtered(lambda x: x.state == 'draft'):
                    r.button_submit
            </field>
        </record>

        <record id="mass_done_realization_action_server" model="ir.actions.server">
            <field name="name">Done</field>
            <field name="model_id" ref="model_budget_realization"/>
            <field name="binding_model_id" ref="model_budget_realization"/>
            <field name="state">code</field>
            <field name="code">
                for r in records.filtered(lambda x: x.state == 'submit'):
                    r.button_done
            </field>
        </record>

        <!-- Sequence -->
        <record id="seq_budget_realization" model="ir.sequence">
            <field name="name">Seq. Budget Realization</field>
            <field name="code">budget.realization</field>
            <field name="prefix">BR/%(y)s/%(month)s/</field>
            <field name="padding">5</field>
        </record>
    
    </data>
    

</odoo>
